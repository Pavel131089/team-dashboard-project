var X=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var _=(l,n,o)=>n in l?X(l,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[n]=o,I=(l,n)=>{for(var o in n||(n={}))se.call(n,o)&&_(l,o,n[o]);if(Y)for(var o of Y(n))te.call(n,o)&&_(l,o,n[o]);return l},O=(l,n)=>Z(l,ee(n));var R=(l,n,o)=>new Promise((x,b)=>{var w=a=>{try{D(o.next(a))}catch(h){b(h)}},S=a=>{try{D(o.throw(a))}catch(h){b(h)}},D=a=>a.done?x(a.value):Promise.resolve(a.value).then(w,S);D((o=o.apply(l,n)).next())});import{j as e,B as M,b as q,c as K,d as Q,w as ae,C as W}from"./ui-CBbhuu0b.js";import{r as u,u as re}from"./vendor-DxaywbHF.js";import{I as y}from"./icon-CeCB3gnH.js";import{P as H,g as ne,T as le,a as ce,b as ie,c as F,d as G,S as z}from"./skeleton-CIHtvRLz.js";import{B as J}from"./badge-D_dw66VG.js";import{a as k,i as oe}from"./index-qiOd5fLb.js";import"./index-DQjIwgLJ.js";const de=({children:l,userName:n,onLogout:o})=>{const x=n||"Сотрудник";return e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsxs("div",{className:"container mx-auto px-4 py-3 flex justify-between items-center",children:[e.jsx("h1",{className:"text-xl font-bold truncate",children:"Личный кабинет"}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsxs("span",{className:"text-sm text-slate-600 flex items-center",children:[e.jsx(y,{name:"User",className:"mr-1 md:mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:x}),e.jsx("span",{className:"md:hidden",children:x})]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:o,children:[e.jsx(y,{name:"LogOut",className:"md:mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Выйти"})]})]})]})}),e.jsx("main",{className:"container mx-auto px-4 py-6",children:l}),e.jsx("footer",{className:"bg-white border-t border-slate-200 py-4 mt-auto",children:e.jsxs("div",{className:"container mx-auto px-4 text-center text-sm text-slate-500",children:["© ",new Date().getFullYear()," Система управления проектами"]})})]})},me=({children:l})=>e.jsxs("div",{className:"w-full max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Мои задачи"}),l]}),V=l=>{const n=typeof l=="number"&&!isNaN(l)?l:0;return n>=75?"bg-green-500":n>=50?"bg-blue-500":n>=25?"bg-yellow-500":"bg-red-500"},xe=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center p-6 text-center",children:[e.jsx(y,{name:"ClipboardList",className:"h-12 w-12 text-slate-300 mb-3"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Нет доступных задач"}),e.jsx("p",{className:"text-sm text-slate-500",children:"В данный момент нет задач, которые вы могли бы взять в работу. Проверьте позже или обратитесь к руководителю проекта."})]}),ue=({tasks:l,onTakeTask:n,projects:o=[]})=>{const x=Array.isArray(l)&&l.length>0,b=a=>{if(!a)return"Не указано";try{return new Date(a).toLocaleDateString("ru-RU")}catch(h){return"Не указано"}},w=a=>{if(!a||!a.tasks||!Array.isArray(a.tasks)||a.tasks.length===0)return 0;const h=a.tasks.reduce((f,v)=>f+(v.progress||0),0);return Math.round(h/a.tasks.length)},S=a=>{if(!a.assignedToNames||!Array.isArray(a.assignedToNames)||a.assignedToNames.length===0)return null;const h=ne(a.assignedToNames);return h==="Не назначено"?null:e.jsx("div",{className:"mt-2 text-xs text-slate-500",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{name:"Users",className:"h-3 w-3"}),e.jsxs("span",{children:["Исполнители: ",h]})]})})},D=a=>{if(Array.isArray(o))return o.find(h=>h.id===a)};return x?e.jsxs(q,{children:[e.jsxs(K,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{name:"Briefcase",className:"text-primary h-5 w-5"}),e.jsx(Q,{children:"Доступные задачи"})]}),e.jsx(ae,{children:"Задачи, которые вы можете взять в работу"})]}),e.jsx(W,{className:"space-y-4",children:l.map((a,h)=>{const f=a.task||a,v=a.project||{},T=f.projectId||v.id,L=D(T)||v,A=L.name||v.name||"Проект",E=w(L),U=L.startDate||v.startDate,d=L.endDate||v.endDate,c=f.startDate||U,s=f.endDate||d;return e.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-base",children:f.name||"Без названия"}),f.description&&e.jsx("p",{className:"text-sm text-slate-600 line-clamp-2 mt-1",children:f.description})]}),e.jsx("div",{className:"bg-slate-100 px-2 py-1 rounded text-xs",children:A})]}),e.jsxs("div",{className:"mt-3 mb-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{name:"Calendar",className:"h-3 w-3"}),e.jsxs("span",{children:["Проект: ",b(U)," —"," ",b(d)]})]}),e.jsxs("span",{children:[E,"% выполнено"]})]}),e.jsx(H,{value:E,className:"h-1.5",indicatorClassName:V(E)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 mt-3 text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{name:"Calendar",className:"h-3 w-3"}),e.jsxs("span",{children:["Начало задачи: ",b(c)]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{name:"CalendarClock",className:"h-3 w-3"}),e.jsxs("span",{children:["Окончание задачи: ",b(s)]})]}),f.estimatedTime!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{name:"Clock",className:"h-3 w-3"}),e.jsxs("span",{children:["Время: ",f.estimatedTime||0," ч."]})]}),f.price!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{name:"CircleDollarSign",className:"h-3 w-3"}),e.jsxs("span",{children:["Цена: ",f.price||0," ₽"]})]})]}),S(f),e.jsxs(M,{onClick:()=>n(f.id,T),className:"w-full mt-3",size:"sm",children:[e.jsx(y,{name:"CheckCircle",className:"mr-2 h-4 w-4"}),"Взять в работу"]})]},f.id||`task-${h}`)})})]}):e.jsx(xe,{})},he=({initialValue:l="",onSubmit:n})=>{const[o,x]=u.useState(l),b=u.useRef(null),w=a=>{x(a.target.value)},S=a=>{a.preventDefault(),a.stopPropagation(),o.trim()&&(n(o),x(""))},D=a=>{a.stopPropagation()};return e.jsxs("form",{onSubmit:S,onClick:D,className:"space-y-2",children:[e.jsx(le,{ref:b,placeholder:"Добавить комментарий...",value:o,onChange:w,onClick:a=>a.stopPropagation(),onFocus:a=>a.stopPropagation(),className:"w-full min-h-[80px] resize-none",autoComplete:"off"}),e.jsxs(M,{type:"submit",size:"sm",disabled:!o.trim(),className:"w-full",onClick:a=>a.stopPropagation(),children:[e.jsx(y,{name:"Send",className:"h-4 w-4 mr-1"}),"Отправить"]})]})},je=({tasks:l,onUpdateProgress:n,onAddComment:o,projects:x=[]})=>{const[b,w]=u.useState({}),[S,D]=u.useState({}),a=s=>S[s]||"",h=Array.isArray(l)?l:[],f=h.filter(s=>(s.progress||0)<100),v=h.filter(s=>(s.progress||0)===100),T=s=>{w(t=>O(I({},t),{[s]:!t[s]}))},L=(s,t,r)=>{r.trim()&&o(s,t,r)},A=s=>{if(!s)return"Не указано";try{const t=new Date(s);return isNaN(t.getTime())?"Неверный формат":t.toLocaleDateString("ru-RU")}catch(t){return"Неверный формат"}},E=u.useMemo(()=>{if(!Array.isArray(h)||h.length===0)return[];const s={};return h.forEach(t=>{t.projectId&&(s[t.projectId]||(s[t.projectId]={projectId:t.projectId,projectName:t.projectName||"Без названия",tasks:[]}),s[t.projectId].tasks.push(t))}),Object.values(s)},[h]),U=({projectInfo:s})=>{var m,N;const t=Math.round(s.tasks.reduce((i,j)=>i+(j.progress||0),0)/Math.max(s.tasks.length,1)),r=u.useMemo(()=>{const i=s.tasks.find(P=>P.fullProject);if(i!=null&&i.fullProject)return i.fullProject;if(Array.isArray(x)){const P=x.find(B=>B.id===s.projectId);if(P)return P}const j=s.tasks[0];return j&&(j.projectStartDate||j.projectEndDate)?{id:s.projectId,name:s.projectName,startDate:j.projectStartDate,endDate:j.projectEndDate,description:"",tasks:[],createdAt:"",createdBy:""}:null},[s.projectId,s.tasks]),p=(r==null?void 0:r.startDate)||((m=s.tasks[0])==null?void 0:m.projectStartDate),g=(r==null?void 0:r.endDate)||((N=s.tasks[0])==null?void 0:N.projectEndDate);return e.jsxs("div",{className:"mb-6 border rounded-md overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 border-b p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h3",{className:"font-medium flex items-center",children:[e.jsx(y,{name:"Folder",className:"h-4 w-4 mr-2 text-primary"}),s.projectName]}),e.jsxs("span",{className:"text-sm",children:[t,"% выполнено"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 text-xs mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Начало:"}),e.jsx("span",{children:p?A(p):"Не указано"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Окончание:"}),e.jsx("span",{children:g?A(g):"Не указано"})]})]}),e.jsx(H,{value:t,className:"h-1",indicatorClassName:V(t)})]}),e.jsx("div",{className:"p-3",children:s.tasks.map(i=>e.jsx(d,{task:i},i.id||`task-${Math.random().toString(36).substring(2,11)}`))})]})},d=({task:s})=>{const t=s.fullProject||{id:s.projectId,name:s.projectName||"Без названия",startDate:s.projectStartDate,endDate:s.projectEndDate};console.log(`TaskItem in EmployeeTasksCard (${s.id}):`,{taskStartDate:s.startDate,taskEndDate:s.endDate,projectStartDate:t.startDate,projectEndDate:t.endDate});const r=s.startDate||t.startDate,p=s.endDate||t.endDate,g=s.id||`task-${Math.random().toString(36).substring(2,11)}`,m=b[g]||!1,N=typeof s.progress=="number"?s.progress:0;return a(g),e.jsxs("div",{className:"border rounded-md mb-3 bg-white",children:[e.jsxs("div",{className:"px-4 py-3 cursor-pointer flex flex-col",onClick:()=>T(g),children:[e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:s.name||"Без названия"}),e.jsx(J,{variant:"outline",className:"ml-2",children:s.projectName||"Проект"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full mt-2",children:[e.jsx(H,{value:N,className:"h-2 w-full",indicatorClassName:V(N)}),e.jsxs("span",{className:"text-xs whitespace-nowrap",children:[N,"%"]}),e.jsx(y,{name:m?"ChevronUp":"ChevronDown",className:"h-4 w-4 ml-1"})]})]}),m&&e.jsx("div",{className:"px-4 pb-4 border-t",children:e.jsxs("div",{className:"space-y-4 pt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 mb-2",children:s.description||"Без описания"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{name:"Calendar",className:"h-3 w-3"}),e.jsxs("span",{children:["Начало: ",A(r)]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{name:"CalendarClock",className:"h-3 w-3"}),e.jsxs("span",{children:["Дедлайн: ",A(p)]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{name:"Clock",className:"h-3 w-3"}),e.jsxs("span",{children:["Время: ",s.estimatedTime||0," ч."]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{name:"CircleDollarSign",className:"h-3 w-3"}),e.jsxs("span",{children:["Цена:"," ",typeof s.price=="number"?s.price.toLocaleString():0," ","₽"]})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Прогресс выполнения"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[0,25,50,75,100].map(i=>e.jsxs(M,{variant:N===i?"default":"outline",size:"sm",onClick:j=>{j.stopPropagation(),n(g,s.projectId,i)},children:[i,"%"]},i))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Комментарии"}),e.jsx("div",{className:"bg-slate-50 p-3 rounded-md mb-3 max-h-40 overflow-y-auto",children:Array.isArray(s.comments)&&s.comments.length>0?e.jsx("div",{className:"space-y-2",children:s.comments.map((i,j)=>e.jsxs("div",{className:"text-sm border-l-2 border-slate-300 pl-2",children:[e.jsxs("p",{className:"text-xs text-slate-500",children:[(i==null?void 0:i.author)||"Система"," •"," ",A(i==null?void 0:i.date)]}),e.jsx("p",{children:(i==null?void 0:i.text)||""})]},j))}):e.jsx("p",{className:"text-sm text-slate-500",children:"Нет комментариев"})}),e.jsx("div",{onClick:i=>i.stopPropagation(),children:e.jsx(he,{onSubmit:i=>{L(g,s.projectId,i)}})})]})]})})]})},c=s=>s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(y,{name:"ClipboardList",className:"mx-auto h-12 w-12 text-slate-300"}),e.jsx("p",{className:"mt-2 text-slate-500",children:"Нет задач"})]}):e.jsx("div",{className:"space-y-3",children:s.map(t=>e.jsx(d,{task:t},t.id||`task-${Math.random().toString(36).substring(2,11)}`))});return e.jsxs(q,{className:"w-full",children:[e.jsx(K,{children:e.jsx(Q,{className:"text-xl",children:"Мои задачи"})}),e.jsx(W,{children:e.jsxs(ce,{defaultValue:"projects",children:[e.jsxs(ie,{className:"w-full mb-4",children:[e.jsxs(F,{value:"projects",className:"flex-1",children:["По проектам"," ",e.jsx(J,{className:"ml-2 bg-primary",children:E.length})]}),e.jsxs(F,{value:"active",className:"flex-1",children:["Активные"," ",e.jsx(J,{className:"ml-2 bg-primary",children:f.length})]}),e.jsxs(F,{value:"completed",className:"flex-1",children:["Завершенные"," ",e.jsx(J,{className:"ml-2 bg-green-600",children:v.length})]})]}),e.jsx(G,{value:"projects",children:E.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(y,{name:"Briefcase",className:"mx-auto h-12 w-12 text-slate-300"}),e.jsx("p",{className:"mt-2 text-slate-500",children:"У вас нет задач в проектах"})]}):e.jsx("div",{className:"space-y-2",children:E.map(s=>e.jsx(U,{projectInfo:s},s.projectId||`project-${Math.random().toString(36).substring(2,11)}`))})}),e.jsx(G,{value:"active",children:c(f)}),e.jsx(G,{value:"completed",children:c(v)})]})})]})};function pe(l){const[n,o]=u.useState(null),[x,b]=u.useState([]),[w,S]=u.useState([]),[D,a]=u.useState([]),[h,f]=u.useState(!0),v=u.useCallback(d=>{d&&sessionStorage.setItem("auth_message",d),localStorage.removeItem("user"),l("/login")},[l]),T=u.useCallback((d,c)=>{const s=[],t=[];try{if(!Array.isArray(d))return console.error("projectsList не является массивом"),{userTasks:s,otherTasks:t};d.forEach(r=>{!r||!Array.isArray(r.tasks)||r.tasks.forEach(p=>{if(!p)return;const g=O(I({},p),{projectId:r.id,projectName:r.name||"Без названия",startDate:p.startDate||r.startDate,endDate:p.endDate||r.endDate,projectStartDate:r.startDate,projectEndDate:r.endDate});let m=!1;p.assignedTo&&c.id&&p.assignedTo===c.id&&(m=!0),!m&&Array.isArray(p.assignedToNames)&&(m=p.assignedToNames.some(N=>{if(!N)return!1;const i=String(N).toLowerCase(),j=c.id?String(c.id).toLowerCase():"",P=c.name?String(c.name).toLowerCase():"",B=c.username?String(c.username).toLowerCase():"";return i===j||i===P||i===B})),m?s.push(g):t.push(g)})})}catch(r){console.error("Ошибка при обработке проектов:",r)}return{userTasks:s,otherTasks:t}},[]);u.useEffect(()=>{R(this,null,function*(){f(!0);try{const c=localStorage.getItem("user");if(!c){v();return}let s;try{if(s=JSON.parse(c),s&&!s.name){const r=localStorage.getItem("users");if(r){const p=JSON.parse(r);if(Array.isArray(p)){const g=p.find(m=>m.id===s.id);g&&g.name&&(s.name=g.name)}}}}catch(r){console.error("Ошибка при парсинге данных пользователя:",r),v("Проблема с данными пользователя");return}if(!s||!s.isAuthenticated){v("Сессия истекла. Пожалуйста, войдите снова.");return}if(s.role==="manager"){l("/dashboard");return}o(s);let t=[];try{const r=localStorage.getItem("projects");t=r?JSON.parse(r):[],console.log("Загружено проектов:",t.length),Array.isArray(t)||(console.error("Данные проектов не являются массивом"),t=[])}catch(r){console.error("Ошибка при загрузке проектов:",r),t=[]}b(t);try{const{userTasks:r,otherTasks:p}=T(t,s);console.log("Задачи пользователя:",r.length),console.log("Доступные задачи:",p.length),S(r),a(p)}catch(r){console.error("Ошибка при обработке задач:",r),S([]),a([])}}catch(c){console.error("Ошибка при загрузке данных:",c)}finally{f(!1)}})},[l,T,v]);const L=u.useCallback((d,c,s)=>{try{if(!Array.isArray(x)||x.length===0)return console.error("Проекты отсутствуют или не являются массивом"),!1;const t=x.find(m=>m.id===c);if(!t)return console.error(`Проект с ID ${c} не найден`),!1;const r=t.tasks.find(m=>m.id===d);if(!r)return console.error(`Задача с ID ${d} не найдена`),!1;const p=O(I({},r),{progress:s,actualStartDate:r.actualStartDate||new Date().toISOString(),actualEndDate:s===100?r.actualEndDate||new Date().toISOString():s<100?null:r.actualEndDate}),g=x.map(m=>m.id===c?O(I({},m),{tasks:m.tasks.map(N=>N.id===d?p:N)}):m);if(localStorage.setItem("projects",JSON.stringify(g)),b(g),n){const{userTasks:m,otherTasks:N}=T(g,n);S(m),a(N)}return!0}catch(t){return console.error("Ошибка при обновлении прогресса:",t),!1}},[x,n,T]);u.useEffect(()=>{},[w,D]);const A=u.useCallback((d,c)=>{if(!n)return setTimeout(()=>{k.error("Необходимо войти в систему")},0),!1;try{const s=x.find(C=>C.id===c);if(!s)return setTimeout(()=>{k.error("Проект не найден")},0),!1;const t=s.tasks.find(C=>C.id===d);if(!t)return setTimeout(()=>{k.error("Задача не найдена")},0),!1;const r=Array.isArray(t.assignedToNames)?[...t.assignedToNames]:[],p=[n.id,n.name,n.username].filter(Boolean).map(C=>String(C).toLowerCase());if(r.some(C=>{if(!C)return!1;const $=String(C).toLowerCase();return p.includes($)}))return setTimeout(()=>{k.info("Эта задача уже назначена вам")},0),!0;const m=n.name||n.id||n.username,N=[...r,m];console.log("Обновление задачи:",{taskId:d,currentAssignedToNames:r,newAssignedToNames:N,userId:n.id,userName:n.name});const i=O(I({},t),{assignedTo:n.id,assignedToNames:N,actualStartDate:t.actualStartDate||new Date().toISOString()}),j=x.map(C=>C.id===c?O(I({},C),{tasks:C.tasks.map($=>$.id===d?i:$)}):C);localStorage.setItem("projects",JSON.stringify(j)),b(j);const{userTasks:P,otherTasks:B}=T(j,n);return S(P),a(B),setTimeout(()=>{k.success("Задача принята в работу")},0),!0}catch(s){return console.error("Ошибка при принятии задачи:",s),setTimeout(()=>{k.error("Ошибка при принятии задачи")},0),!1}},[x,n,T]),E=u.useCallback((d,c,s)=>{if(!n||!s.trim())return!1;try{const t=x.find(j=>j.id===c);if(!t)return console.error("Проект не найден"),!1;const r=t.tasks.find(j=>j.id===d);if(!r)return console.error("Задача не найдена"),!1;const p={id:`comment-${Date.now()}`,text:s,author:n.name||"Сотрудник",date:new Date().toISOString()},g=O(I({},r),{comments:[...Array.isArray(r.comments)?r.comments:[],p]}),m=x.map(j=>j.id===c?O(I({},j),{tasks:j.tasks.map(P=>P.id===d?g:P)}):j);localStorage.setItem("projects",JSON.stringify(m)),b(m);const{userTasks:N,otherTasks:i}=T(m,n);return S(N),a(i),!0}catch(t){return console.error("Ошибка при добавлении комментария:",t),!1}},[x,n,T]),U=u.useCallback(()=>{localStorage.removeItem("user"),l("/login")},[l]);return{user:n,assignedTasks:w,availableTasks:D,projects:x,isLoading:h,handleTakeTask:A,handleUpdateTaskProgress:L,handleAddTaskComment:E,handleLogout:U}}const De=()=>{const l=re(),[n,o]=u.useState(!1),[x,b]=u.useState(!1),{assignedTasks:w,availableTasks:S,projects:D,user:a,isLoading:h,handleTakeTask:f,handleUpdateTaskProgress:v,handleAddTaskComment:T,handleLogout:L}=pe(l);u.useEffect(()=>{R(void 0,null,function*(){try{yield oe(),o(!0)}catch(c){console.error("Ошибка при инициализации хранилища:",c),o(!0)}})},[]),u.useEffect(()=>{!h&&!a&&b(!0)},[h,a]),u.useEffect(()=>{x&&l("/login")},[x,l]);const A=u.useCallback((d,c)=>{console.log("Попытка взять задачу в работу:",{taskId:d,projectId:c});const s=f(d,c);return console.log("Результат взятия задачи:",s),setTimeout(()=>{s?k.success("Задача принята в работу"):k.error("Не удалось принять задачу")},0),s},[f]),E=u.useCallback((d,c,s)=>{const t=v(d,c,s);return setTimeout(()=>{t?k.success(`Прогресс обновлен: ${s}%`):k.error("Не удалось обновить прогресс")},0),t},[v]),U=u.useCallback((d,c,s)=>{console.log("Добавление комментария:",{taskId:d,projectId:c,comment:s});const t=T(d,c,s);return setTimeout(()=>{t?k.success("Комментарий добавлен"):k.error("Не удалось добавить комментарий")},0),t},[T]);return h||!n?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(z,{className:"h-12 w-full"}),e.jsx(z,{className:"h-8 w-48"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(z,{className:"h-64 w-full"}),e.jsx(z,{className:"h-64 w-full"})]})]}):a?e.jsx(de,{userName:a.name||"",onLogout:L,children:e.jsx(me,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(je,{tasks:w,onUpdateProgress:E,onAddComment:U,projects:D}),e.jsx(ue,{tasks:S,onTakeTask:A,projects:D})]})})}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl",children:"Ошибка авторизации"}),e.jsx("p",{className:"mt-2",children:"Пожалуйста, войдите в систему"}),e.jsx(M,{className:"mt-4",onClick:()=>l("/login"),children:"Перейти на страницу входа"})]})})};export{De as default};
//# sourceMappingURL=Employee-BSdznIy6.js.map
