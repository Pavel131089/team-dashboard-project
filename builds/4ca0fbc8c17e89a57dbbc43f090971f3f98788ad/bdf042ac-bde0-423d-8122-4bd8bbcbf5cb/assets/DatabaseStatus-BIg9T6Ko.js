var y=(s,r,n)=>new Promise((l,m)=>{var i=c=>{try{x(n.next(c))}catch(h){m(h)}},u=c=>{try{x(n.throw(c))}catch(h){m(h)}},x=c=>c.done?l(c.value):Promise.resolve(c.value).then(i,u);x((n=n.apply(s,r)).next())});import{j as e,b as v,c as T,d as A,w as D,C as I,B as f,a as k}from"./ui-CBbhuu0b.js";import{I as o}from"./icon-CeCB3gnH.js";import{r as j}from"./vendor-DxaywbHF.js";import{A as p,a as S,b as N}from"./alert-FLBE-qXf.js";import{a as w}from"./index-qiOd5fLb.js";import{B as R}from"./badge-D_dw66VG.js";const L=()=>{const[s,r]=j.useState(null),[n,l]=j.useState(!1),[m,i]=j.useState([]);j.useEffect(()=>{u()},[]);const u=()=>y(void 0,null,function*(){l(!0);try{const c="test_connection_"+Date.now();localStorage.setItem(c,"test"),localStorage.getItem(c)==="test"?(localStorage.removeItem(c),r(!0)):r(!1)}catch(c){console.error("Ошибка при проверке подключения:",c),r(!1)}finally{l(!1)}}),x=()=>y(void 0,null,function*(){l(!0),i([]),w.info("Запуск тестов базы данных...");let c=!1;try{const a="db_test_write_"+Date.now();localStorage.setItem(a,JSON.stringify({test:!0,timestamp:Date.now()})),c=!0,i(t=>[...t,{name:"Запись данных",success:!0,message:"Запись в хранилище выполнена успешно"}])}catch(a){console.error("Ошибка при тесте записи:",a),i(t=>[...t,{name:"Запись данных",success:!1,message:"Не удалось записать данные в хранилище"}])}yield new Promise(a=>setTimeout(a,500));try{const a=localStorage.getItem("users"),t=localStorage.getItem("projects"),d=a?JSON.parse(a):null,g=t?JSON.parse(t):null;i(b=>[...b,{name:"Чтение данных",success:!0,message:`Успешно прочитаны данные: пользователи (${d?Array.isArray(d)?d.length:"не массив":"нет"}), проекты (${g?Array.isArray(g)?g.length:"не массив":"нет"})`}])}catch(a){console.error("Ошибка при тесте чтения:",a),i(t=>[...t,{name:"Чтение данных",success:!1,message:"Не удалось прочитать данные из хранилища"}])}if(yield new Promise(a=>setTimeout(a,500)),c)try{const a=Object.keys(localStorage).filter(t=>t.startsWith("db_test_"));a.forEach(t=>localStorage.removeItem(t)),i(t=>[...t,{name:"Удаление данных",success:!0,message:`Успешно удалены тестовые данные (${a.length} ключей)`}])}catch(a){console.error("Ошибка при тесте удаления:",a),i(t=>[...t,{name:"Удаление данных",success:!1,message:"Не удалось удалить данные из хранилища"}])}l(!1),m.every(a=>a.success)?w.success("Все тесты базы данных пройдены успешно"):w.error("Некоторые тесты базы данных не пройдены")});return e.jsxs(v,{className:"w-full",children:[e.jsxs(T,{children:[e.jsxs(A,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Статус подключения к хранилищу"}),e.jsx(_,{isConnected:s})]}),e.jsx(D,{children:"Тестирование подключения к хранилищу данных и операций"})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsx(B,{connectionStatus:s,isLoading:n}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(f,{onClick:u,disabled:n,variant:"outline",children:[n?e.jsx(o,{name:"Loader2",className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(o,{name:"RefreshCw",className:"mr-2 h-4 w-4"}),"Проверить подключение"]}),e.jsxs(f,{onClick:x,disabled:n||s!==!0,children:[e.jsx(o,{name:"Database",className:"mr-2 h-4 w-4"}),"Запустить тесты базы данных"]})]}),m.length>0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Результаты тестирования:"}),e.jsx("div",{className:"space-y-2",children:m.map((c,h)=>e.jsx(O,{result:c},h))})]})]}),e.jsx(k,{className:"flex justify-between border-t pt-4 text-xs text-slate-500",children:e.jsxs("div",{children:[e.jsx("p",{children:"Локальное хранилище (localStorage)"}),e.jsxs("p",{children:["Последняя проверка:"," ",s!==null?new Date().toLocaleString():"—"]})]})})]})},_=({isConnected:s})=>{if(s===null)return e.jsx("div",{className:"px-2 py-1 text-xs font-medium rounded-md bg-blue-100 text-blue-800",children:"Проверка..."});const r=s?"bg-green-100 text-green-800":"bg-red-100 text-red-800";return e.jsx("div",{className:`px-2 py-1 text-xs font-medium rounded-md ${r}`,children:s?"Подключено":"Отключено"})},B=({connectionStatus:s,isLoading:r})=>r?e.jsxs(p,{className:"bg-blue-50 text-blue-800 border-blue-200",children:[e.jsx(o,{name:"Loader2",className:"h-4 w-4 animate-spin"}),e.jsx(S,{children:"Проверка подключения"}),e.jsx(N,{children:"Выполняется проверка доступности локального хранилища..."})]}):s===!1?e.jsxs(p,{variant:"destructive",children:[e.jsx(o,{name:"AlertTriangle",className:"h-4 w-4"}),e.jsx(S,{children:"Проблема с подключением"}),e.jsx(N,{children:"Локальное хранилище недоступно. Возможно, браузер блокирует доступ к localStorage или включен режим приватного просмотра."})]}):s===!0?e.jsxs(p,{className:"bg-green-50 text-green-800 border-green-200",children:[e.jsx(o,{name:"CheckCircle",className:"h-4 w-4"}),e.jsx(S,{children:"Подключение установлено"}),e.jsx(N,{children:"Локальное хранилище доступно и работает корректно."})]}):null,O=({result:s})=>{const{name:r,success:n,message:l}=s;return e.jsxs("div",{className:`p-2 rounded-md ${n?"bg-green-50":"bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center",children:[n?e.jsx(o,{name:"CheckCircle",className:"h-4 w-4 text-green-600 mr-2"}):e.jsx(o,{name:"XCircle",className:"h-4 w-4 text-red-600 mr-2"}),e.jsx("span",{className:"font-medium",children:r})]}),e.jsx("p",{className:`text-xs mt-1 ${n?"text-green-800":"text-red-800"}`,children:l})]})},$=({status:s})=>{const r=l=>{switch(l){case"idle":return"bg-slate-100 text-slate-800";case"syncing":return"bg-blue-100 text-blue-800";case"success":return"bg-green-100 text-green-800";case"error":return"bg-red-100 text-red-800";default:return"bg-slate-100 text-slate-800"}},n=l=>{switch(l){case"idle":return"Не синхронизировано";case"syncing":return"Синхронизация...";case"success":return"Синхронизировано";case"error":return"Ошибка синхронизации";default:return"Неизвестный статус"}};return e.jsx(R,{variant:"outline",className:r(s),children:n(s)})},E=({isSyncing:s,onRefreshStats:r,onUploadToCloud:n,onDownloadFromCloud:l})=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(f,{variant:"outline",className:"w-full",disabled:s,onClick:r,children:[e.jsx(o,{name:"RefreshCw",className:"mr-2 h-4 w-4"}),"Обновить статистику"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(f,{disabled:s,onClick:n,children:[e.jsx(o,{name:"Upload",className:"mr-2 h-4 w-4"}),"Загрузить в облако"]}),e.jsxs(f,{disabled:s,onClick:l,children:[e.jsx(o,{name:"Download",className:"mr-2 h-4 w-4"}),"Загрузить из облака"]})]})]}),J=()=>{const[s,r]=j.useState("idle"),[n,l]=j.useState(null),[m,i]=j.useState({users:0,projects:0});j.useEffect(()=>{u();const t=localStorage.getItem("lastSyncTime");t&&l(t)},[]);const u=()=>{try{const t=localStorage.getItem("users")||"[]",d=localStorage.getItem("projects")||"[]",g=JSON.parse(t),b=JSON.parse(d);i({users:Array.isArray(g)?g.length:0,projects:Array.isArray(b)?b.length:0}),s==="error"&&r("idle")}catch(t){console.error("Ошибка при загрузке статистики:",t),r("error")}},x=t=>{r("syncing"),setTimeout(()=>{try{console.log(t==="upload"?"Имитация загрузки данных в облако...":"Имитация загрузки данных из облака..."),r("success");const d=new Date().toLocaleString();l(d),localStorage.setItem("lastSyncTime",d),u()}catch(d){console.error("Ошибка при синхронизации:",d),r("error")}},2e3)},c=u,h=()=>x("upload"),a=()=>x("download");return e.jsxs(v,{children:[e.jsx(T,{children:e.jsxs(A,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Синхронизация данных"}),e.jsx($,{status:s})]})}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(C,{title:"Пользователи",count:m.users}),e.jsx(C,{title:"Проекты",count:m.projects})]}),e.jsx(E,{isSyncing:s==="syncing",onRefreshStats:c,onUploadToCloud:h,onDownloadFromCloud:a}),s==="success"&&e.jsxs(p,{className:"bg-green-50 text-green-800 border-green-200",children:[e.jsx(o,{name:"CheckCircle",className:"h-4 w-4"}),e.jsx(S,{children:"Синхронизация выполнена успешно"}),e.jsx(N,{children:"Данные успешно синхронизированы с облаком."})]}),s==="error"&&e.jsxs(p,{variant:"destructive",children:[e.jsx(o,{name:"AlertTriangle",className:"h-4 w-4"}),e.jsx(S,{children:"Ошибка синхронизации"}),e.jsx(N,{children:"Не удалось выполнить синхронизацию. Пожалуйста, попробуйте позже."})]}),n&&e.jsxs("div",{className:"text-xs text-slate-500 text-center mt-2",children:["Последняя синхронизация: ",n]})]})]})},C=({title:s,count:r})=>e.jsxs("div",{className:"flex flex-col items-center justify-center p-4 bg-slate-50 rounded-lg",children:[e.jsx(o,{name:s==="Пользователи"?"Users":"FolderKanban",className:"h-8 w-8 mb-2 text-slate-500"}),e.jsx("h3",{className:"font-medium text-sm",children:s}),e.jsx("p",{className:"text-2xl font-bold",children:r})]}),H=()=>{const s=()=>{window.location.href="/dashboard"};return e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsxs("div",{className:"container mx-auto px-4 py-3 flex justify-between items-center",children:[e.jsx("h1",{className:"text-xl font-bold truncate",children:"Статус базы данных"}),e.jsx("div",{className:"flex items-center gap-2 md:gap-4",children:e.jsxs(f,{variant:"outline",size:"sm",onClick:s,children:[e.jsx(o,{name:"ArrowLeft",className:"mr-2 h-4 w-4"}),"Вернуться к панели"]})})]})}),e.jsx("main",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(L,{}),e.jsx(J,{})]})})]})};export{H as default};
//# sourceMappingURL=DatabaseStatus-BIg9T6Ko.js.map
